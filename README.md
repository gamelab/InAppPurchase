Name: InAppPurchase Plugin.
Version: 1.0.0
Author: Kiwi.js Team
Website: www.kiwijs.org
Kiwi.js Version Last Tested: 1.0.0


Versions:
============

#1.0.0 
- Initial released version of this plugin. 


Files/Folders:
============
* README.md 	- This readme file.
* docs/ 		- Documentation generated by yuidocs.
* examples/ 	- Examples of the in-app purchase plugin in action. 
* src/		- JavaScript plugin. 
* libs/		- External Libraries that this plugin requires.


Description:
============

	Made to help bring the inAppPurchase functionality that Cocoon offer's more easily accessable, and to use into Kiwi. 
	This is so that when you are using Kiwi you can more easily execute the Cocoon code, add callbacks and access products/purchases made across the entire game without having to add in your own 'custom' management classes.

	Whilst using this plugin it may be good to make use of the saveGame plugin, and the bitmap text plugin also.
	With the saveGame you can make use to localstorage to save any of your own 'currency' you may have. And the bitmaptext will allow you to more easily style any text you would like in-game.

	If you have any problems then feel free to contact us via the [www.kiwijs.org](http://www.kiwijs.org/help) help form.


Tutorials:
============
	For examples, tutorials or more information about the In App Purchasing plugin, visit the (www.kiwijs.org/documentation/tutorials/in-app-purchase-documentation)[http://www.kiwijs.org/documentation/tutorials/in-app-purchase-documentation/] page.

Examples:
============

	Inside the examples folder you can find three different examples of how you can use the inAppPurchase plugin. Each example functions in a different way to show varying methods of how you can implement IAP into your own game.

	##Intro
		This first example is a introductory examples of how you can have intergrate IAP into your game. It is the easiest of the examples codewise. In this example the productIDs are 'hard-coded' into the game, which means each time you want to add a new product to your shop, you would have to update the APP. No scrolling is added in this example.

	##Sierra
	 	The second example is slightly more complex than the first and demonstrates how you can get productID's (plus other information if you wanted to extend this example further) off a external server, which the example then uses to valid the products. This way you could easily add products without having to compile and update the app each time.

	 ##BootCamp 
	 	Bootcamp is a more robust example. In this example, we are using the platforms shop to buy 'virtual currency', which they can use to purchase weapons in the gam.e Like the sierra shop we are getting the products off a external server but in this example we are also sending throught the platform that we are requesting the productIDs for.


How to Include: 
============

##First Step:
	* Copy either the cocoonInAppPurchase.js or the cocoonInAppPurchase.min.js file (they should be right next to this one right now) into your project directory. We recommend that you save the files under a plugin directory that lives inside of your project directory so that you can easily manage all of the plugins but that is not required.

	* Now copy across the CocoonJSExtensions folder also. You can either put the Extensions folder inside the plugins folder where we put the cocoonInAppPurchase or you can put it next to the plugin directory as the files inside of CocoonJSExtensions are not exclusive to this plugin.  


##Second Step:
	* Firstly link in all of the javascript files inside of the CocoonJSExtensions folder in the following order. To be safe include these above Kiwi and your own game code :)
		1- CocoonJS.js
		2- CocoonJS_Ad.js
		3- CocoonJS_App.js
		4- CocoonJS_App_ForCocoonJS.js
		5- CocoonJS_Store.js

	* Link in the JavaScript file (cocoonInAppPurchase.js or the min version of the file) into your HTML file. Make sure you link it in underneath the link to the main Kiwi.js file AND underneath all of the Cocoon files.


##Third: 
	* Now that you have linked in the plugin, the next step is to tell the game to use this plugin. To do so, when you create a new Kiwi.Game you need to pass 'CocoonInAppPurchase' the confiration object's plugins item. You can see an example of the code below.

		var game = new Kiwi.Game('domElement', 'GameName', 'State', { plugins: ["CocoonInAppPurchase"]});

	* Just make sure if you are including more than one System plugin that you pass other plugin's that you want to use also. (Like that SaveGame plugin you might be using).


##Lastly:
	* Now that you have successfully include the plugin you can start using it. You can access the 'inAppPurchase' through the game object.


How to use.
============

	This plugin is designed to bring the functionality of inAppPurchasing to HTML 5 games that you make which are using CocoonJS. So whilst you are developing your game (or at least the inAppPurchase part of the game) you will need to make sure you test on a Cocoon supported device using either their free app, or a compiled of your game using their cloud compiler. 

	The link below will help :)
	http://www.ludei.com/tech/cocoonjs


Take Note! Very Important
============

	* This app will only work if you are making Cocoon apps and are targeting Cocoon when creating your games. Otherwise unexpected results will happen and the in app purchasing may not work.

	* When using this app make sure that you are testing it on a Cocoon enabled app.

	* You will still need to have some knowledge of the various markets with the different types of products and how they are handled/what they can do. We have tutorials on the Kiwi.JS website to help you with that. [www.kiwijs.org/documentation/tutorials/in-app-purchase-documentation](http://www.kiwijs.org/documentation/tutorials/in-app-purchase-documentation/) 

	* All callbacks are Kiwi Signals, and so take this into account when you try to add callbacks to each property. 


Purchase / Product Objects
============
	Throughout the plugin and its process two types of object are consistently used. Purchase and Product objects. The following documents the various indexs/namespaces located on them.

	##Purchase Object
		* transactionId 
		* purchaseTime
		* purchaseState - (See below for documentation)
		* productId
		* quantity

	
	##Product Object
		* productId
		* productAtlas
		* productType - (See below for documentation)
		* title
		* description
		* price 
		* localizedPrice - The localized price of the product if appropriate.
		* downloadURL - The URL of any assets needing to be downloaded, can be blank.


Starting Off.
============

	This section is for what to do after you have included this plugin into your Kiwi Game (see the "How to Include" section). 

	1- Set up your callbacks / event listeners.
		The first step before you initalise the inAppPurchasing is to add all of the callbacks you will require for you store. (See the below sections for what callbacks there are). This is because sometimes events can fire immediately after/while the store is being initalised, due to previous visits that perhaps were not finished prior.   

	2- Execute the init method.
		Once the callbacks have been added, the next step is to execute the "init" method on the "inAppPurchase" object of your game. When you execute this method it tells Cocoon that you are ready to start the store process and the callbacks/events will start to fire, purchasing of products will now work, e.t.c. 

		//Example
		this.game.inAppPurchase.init(false, true);

		The first parameter tells cocoon if it should execute in a "managed" mode or not. Managed mode is best and easiest way, as then Cocoon's backend service will handle the product verification process but you can always do it yourself if you want. See more information about it through the links below.

			[www.kiwijs.org/documentation/tutorials/using-the-in-app-purchase-plugin](http://www.kiwijs.org/documentation/tutorials/using-the-in-app-purchase-plugin/#init-store)
			[wiki.ludei.com/cocoonjs:extensions:store#managed_mode](http://wiki.ludei.com/cocoonjs:extensions:store#managed_mode)
			[wiki.ludei.com/cocoonjs:extensions:store#unmanaged_mode](http://wiki.ludei.com/cocoonjs:extensions:store#unmanaged_mode)

		Now the second parameter indicates if the store should be in a 'sandbox' mode or not. This is useful whilst developing your app and testing it out as then you can make sure everything works as it should in store.

	3- Fetch the valid Products
		Before you can start 


Retrieving Products.
============
	* Make sure you have already done the 'Starting Off' section.


	##Callbacks
		//When the fetching process started. 
		this.game.inAppPurchase.onFetchStarted

		//When fetching products fails. Passes the error as to why it failed.
		this.game.inAppPurchase.onFetchFailed

		//When fetching of products was successful. Passes an array containing all of the products successfully retrieved.
		this.game.inAppPurchase.onFetchComplete


	##Steps
		1- Get your Product Information from the Store.
			Now that we have initalised the store, we will now need to get the product information from the store, and add it to our local database. This is so that when we try to purchase a product it doesn't fail because the two didn't match up. For this you will have to have a list of all of the productIds that exist for app, where you store this is up to you (could be on a server that you use a XHR request to get, or could just be as a string), but you need to able to access it and then execute the "fetchProductsFromStore" method.

			Note: Before you get the products from the store make sure you have added callbacks to the methods above. Also you can also request the product information from the Store if you are no developing it in a 'testing' enviroment.

			//Request all of the methods.
			this.game.inAppPurchase.fetchProductsFromStore( arrayOfProductIds );


		2- Add it to the local database.
			Once the fetch method is successful the onFetchComplete signal will dispatch a callback saying it was successful and the first parameter of the callback will contain an array of objects contain all of the product information. You then need to add the products to the local database to ensure that when you go to purchase a product the local database and the store will match. 

			To do this you have two options.

			1 - Before you execute the "fetchProductsFromStore" method make the "addProducts" property true. This property will make the plugin automatically add the products to the local database when fetched from the store. 

			2 - Add the products yourself using the "addProduct" method on the plugin. 
	

	##Other Details.
		* Getting Products Afterwards 
			If you want to get products that may already exist on the local database you can access them through the "products" array that exists on the "inAppPurchase" plugin.

		* Removing Products
			If you want to remove a product that no longer exists then you can execute the "removeProduct" method which only needs the id of the product you would like to remove. 


Purchasing a Product.
============
	* Make sure you have already done the 'Retrieving Products' section.

	Once you have successfully added the products to the local database, you can then start purchasing products. 
	Make sure you have added callbacks to the methods below first of all. They should be before you run the "init" method.


	##Callbacks
		If you haven't already, you will need to add the callbacks to the "inAppPurchase" item.

		//Dispatches when a product purchase has started.
		this.game.inAppPurchase.onPurchaseStarted

		//Dispatches when a product purchase has failed. When the methods are executed they will have two parameters.
		/*
		* First - productId - The id of the product that failed. 
		* Second - error - The reason the product has failed.  
		*/
		this.game.inAppPurchase.onPurchaseFailed

		//Dispatches when a purchase was completed.
		//The callbacks will have a parameter which is a purchase object (documented above) contain information like the transactionId, productId, time, e.t.c. 
		this.game.inAppPurchase.onPurchaseComplete

		//Used only if you are using the "unmanaged" version of the CocoonJS store. 
		/**
		* The following method is only used if you are using the "unmanaged" store. 
		* When this method is executed you have to validate the purchase yourself and if it is successful then execute the "finishPurchase" method. 
		*/
		this.game.inAppPurchase.onPurchaseVertification

	
	##Steps
		1- Choose the appropriate method
		When wanting a user to purchase a product you have three different methods to choose from. Each one will work, but the user interface in each case is a little bit different. Each one requires you to pass in the id of the product you want to purchase. 

		Note: Make sure you have added the purchase callbacks first! 

			//Purchases the product with no native notification to the user.  
			this.game.inAppPurchase.purchaseProduct( prodID );

			//Purchases the product with a modal progress dialog.
			this.game.inAppPurchase.purchaseProductModal( prodID ); 

			//Purchases the product with a modal progress dialog and a preview of the product. 
			this.game.inAppPurchase.purchaseProductModalWithPreview( prodID );

		2- Wait for Callbacks / Own code
		When the user has completed the product purchasing section brought the product your "onPurchaseComplete" callback should then execute. Once this happens you know they have brought the product and you can do your own code to ensure that they get what you promised them. 

		3- Saving Purchase Info
		By default purchase information in Cocoon is not persistent (won't be saved in its database). So if you want you can always save the purchase information yourself by using the "addPurchase" method, which just requires you passing in the purchase object returned by the "onPurchaseComplete" callback. Alternatively you can also turn the "addPurchases" boolean on and the plugin will automatically save the purchase details for you.


	##Other Details 
		* Getting Purchases Afterwards
		If you need to ever get purchase information afterwards you can access the details through the 'purchases' object on the "inAppPurchase" object. Note that it will only contain purchases information save in the purchases database, purchases not saved or that have been removed won't be accessable. 

		* Removing a Purchase
		You can always remove purchase information from the local database using the "removePurchase" method. All it requires is the "transactionId" of the purchase you want to remove.  


Consuming a Purchase.
============
	* Make sure you have already done the 'Starting Off' and 'Purchasing a Product' sections.

	When want a user to be able to purchase a product multiple times some stores required (and it is good to do anyway) that any previous purchases of that  product be 'consumed' first. This is to prevent any 'That product was already brought' errors that may occur during the purchase stage. The typical type of product you would like to do this with is 'consumable' types of products. 

	Note: That once a purchase has been consumed you can no longer 'restore' the purchase. 


	##Callbacks 
		//Dispatches when the consumation of a purchase has been started. Callbacks have a single parameter being the transactionId of the purchase.
		this.game.inAppPurchase.onConsumeStarted

		//Dispatches when the consumation of a purchase has failed. Callbacks have two parameters.
		/*
		* First - transactionId - The id of the transaction that failed
		* Second - error - The reason as to why it failed.
		*/
		this.game.inAppPurchase.onConsumeFailed

		//Dispatches when the consumation of a purchase was a successful. Callbacks have a single parameter being the transactionId of the purchase.
		this.game.inAppPurchase.onConsumeComplete


	##Consume Methods.
		When wanting to consume a purchase you have two options avaiable.

		1- Manual.
		You can manually 'consume' a purchase by using the "consumePurchase" method, which requires the purchase object be passed to it.

		2- Auto Consume.
		If you enable the "autoConsume" boolean (located on the "inAppPurchase" object) the plugin will automatically consume any purchases that are of the productType "CONSUMEABLE". This is to provide an easy way to manage consumeable items.  


Restoring Purchases.
============
	* Some types of products require a restore feature on the app store.

	When having certain types of products (typically subscriptions) you are required by some stores to have a way to "restore" the purchases back. 


	##Callbacks
		//Dispatches when the restoration is started. 
		this.game.inAppPurchase.onRestoreStarted

		//Dispatches when the restoration fails. An error is passed as a parameter to any method fired by this event.
		this.game.inAppPurchase.onRestoreFailed

		//Dispatches when the restoration process was completed. An array of products that were restored is passed as a parameter to any method fired by this event. 
		this.game.inAppPurchase.onRestoreComplete

		//Restore all the purchases made.
		this.game.inAppPurchase.restorePurchases();


	##Restore
		//Restore all the purchases with a progress dialog.
		this.game.inAppPurchase.restorePurchasesModal();


Product Types.
============

A brief list containing the different types of products. See market/platform documentation for more information. 	

	* CONSUMABLE - 0

	* NON-CONSUMABLE - 1 

	* AUTO_RENEWABLE_SUBSCRIPTION - 2 

	* FREE_SUBSCRIPTION - 3

	* NON_RENEWABLE_SUBSCRIPTION - 4

Note: Each product object contains a "productType" index. That index is a number that relates to one of the following on the list above. You can detiremine what a type of product is through STATIC properties located on "Kiwi.Plugins.CocoonInAppPurchase.InAppPurchase.PRODUCT_TYPE"    


Store Types.
============

When developing your app you may need to change certain implementations depending on the type of store. You can get the store being used through either the "storeType" property or the "getStore" method on the "inAppPurchase" object.

	* APP_STORE - 0

	* PLAY_STORE - 1

 	* MOCK_STORE - 2

	* CHROME_STORE - 3

	* AMAZON_STORE - 4

	* NOOK_STORE - 5

You can access these STATIC versions of these numbers with the corresponding store type through "Kiwi.Plugins.CocoonInAppPurchase.InAppPurchase.STORE_TYPE"


Purchase States
============

When a purchase is complete a 'purchaseState' will be on the 'purchase' object containing if the purchase was a success or not.

	* PURCHASED - 0

	* CANCELED - 1

	* REFUNDED - 2

	* EXPIRED - 3

You can access STATIC versions of these numbers with the corresponding numbers through "Kiwi.Plugins.CocoonInAppPurchase.InAppPurchase.PURCHASE_STATE"


Testing Methods.
============
	While testing out your app you will want to make sure that if the user 'declines' at any part of the process your app will still work. These methods are there to help out with that. 

	Note: The following methods are used only in the development/testing stages and will NOT work in a production enviroment.

	//Simulates the refunding of a purchase. 
	this.game.inAppPurchase.refundPurchase( transactionId );

	//Simulates the cancelation of a purchase.
	this.game.inAppPurchase.cancelPurchase( transactionId );

	//Simulates the expiration of a purchase
	this.game.inAppPurchase.expirePurchase( transactionId ); 

