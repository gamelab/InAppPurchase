Kiwi.Plugins.InAppPurchase={name:"InAppPurchase",version:"2.0.0",minimumKiwiVersion:"1.3.0",deviceReady:!1},Kiwi.PluginManager.register(Kiwi.Plugins.InAppPurchase),document.addEventListener("deviceready",function(){Kiwi.Plugins.InAppPurchase.deviceReady=!0}),Kiwi.Plugins.InAppPurchase.create=function(a){return a.inAppPurchase=new Kiwi.Plugins.InAppPurchase.InAppPurchase(a),a.inAppPurchase},Kiwi.Plugins.InAppPurchase.InAppPurchase=function(a){this.game=a},Kiwi.Plugins.InAppPurchase.InAppPurchase.prototype={boot:function(){this.active=!1,this.onPurchaseStarted=new Kiwi.Signal,this.onPurchaseFailed=new Kiwi.Signal,this.onPurchaseComplete=new Kiwi.Signal},objType:function(){return"inAppPurchase"},log:function(a){this.game.debugOption===Kiwi.DEBUG_ON&&Kiwi.Log.log("IAP:",a,"#inAppPurchase")},available:function(){return Kiwi.Plugins.InAppPurchase.deviceReady&&this.active&&Cocoon.InApp.canPurchase()},init:function(a,b,c){if(!Kiwi.Plugins.InAppPurchase.deviceReady)return this.log("Could not initialise store. Device not ready yet"),!1;if("undefined"==typeof Cocoon||"undefined"==typeof Cocoon.InApp)return this.log("Could not initialise store. Cocoon Namespaces not found"),!1;this.log("Initialisation Starting"),this._startEvents();var d=this;return Cocoon.InApp.initialize({autofinish:!0},function(e){return d.active=!!e,!a||e?void(b&&b.call(c,e)):(d.log("Store successfully started"),void d.fetchProducts(a,b,c))}),!0},fetchProducts:function(a,b,c){return this.available()?(this.log("Fetching products from store"),void Cocoon.InApp.fetchProducts(a,function(a,d){d&&this.log("Fetch products failed:"+d),b&&b.call(c,d,a)})):(this.log("Fetch can't be performed"),void(b&&b.call(c,"Device doesn't support IAP")))},purchase:function(a,b,c,d){return this.available()?(this.log("Purchase of a product started"),"undefined"==typeof b&&(b=1),void Cocoon.InApp.purchase(a,b,function(a){c&&c.call(d,a)})):(this.log("Purchase of a product can't be performed"),void(c&&c.call(d,"Device doesn't support IAP")))},isPurchased:function(a){return this.available()?Cocoon.InApp.isPurchased(a):(this.log("isPurchase can't be performed"),!1)},consume:function(a,b,c,d){return this.available()?("undefined"==typeof b&&(b=1),this.log("Consuming "+b+" "+a),void Cocoon.InApp.consume(a,b,function(a,b){c&&c.call(d,b,a)})):(this.log("Purchase comsume process failed."),void(c&&c.call(d,0,"Device doesn't support IAP")))},restore:function(){return this.available()?(this.log("Restore process starting."),void Cocoon.InApp.restorePurchases()):void this.log("Purchase restore process failed.")},productForId:function(a){return this.available()?Cocoon.InApp.productForId(a):(this.log("isPurchase can't be performed"),!1)},products:function(){return this.available()?Cocoon.InApp.getProducts():(this.log("products can't be performed"),!1)},setValidationHandler:function(a,b){return this.available()?void Cocoon.InApp.setValidationHandler(function(c,d,e){this.log("Validation needed for "+c),a.call(b,c,d,e)}):(this.log("setValidationHandler can't be performed"),!1)},_startEvents:function(){var a=this;Cocoon.InApp.on("purchase",{start:function(b){a.log("Purchase started: "+b),a.onPurchaseStarted.dispatch(b)},error:function(b,c){console.log("purchase failed "+b+" error: "+JSON.stringify(c)),a.log("Purchase failed: "+b+" "+c),a.onPurchaseFailed.dispatch(c,b)},complete:function(b){a.log("Purchase completed: "+b.producyId),a.onPurchaseComplete.dispatch(b)}})}};