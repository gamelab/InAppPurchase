Kiwi.Plugins.InAppPurchase={name:"InAppPurchase",version:"1.1.0",minimumKiwiVersion:"1.3.0"},Kiwi.PluginManager.register(Kiwi.Plugins.InAppPurchase),Kiwi.Plugins.InAppPurchase.create=function(a){return a.inAppPurchase=new Kiwi.Plugins.InAppPurchase.InAppPurchase(a),a.inAppPurchase},Kiwi.Plugins.InAppPurchase.InAppPurchase=function(a){this.game=a,this.available=!1},Kiwi.Plugins.InAppPurchase.InAppPurchase.prototype.boot=function(){this.bundleId=null,this.apiVersion=null,this.storeType=Cocoon&&Cocoon.Store?Cocoon&&Cocoon.Store&&Cocoon.Store.getStoreType():-1,this._products=[],this._purchases=[],this.addPurchases=!0,this.addProducts=!1,this.autoConsume=!1,this._managed=null,this._sandbox=null,this._createCallbacks(),Cocoon.Store.nativeAvailable&&this.game.deviceTargetOption==Kiwi.TARGET_COCOON&&0==Cocoon.Store.canPurchase()?this.game.debugOption==Kiwi.DEBUG_ON&&console.log("Cannot Use the InAppPurchase Plugin."):this.available=!0},Kiwi.Plugins.InAppPurchase.InAppPurchase.prototype.getStoreType=function(){return Cocoon.Store.getStoreType()},Kiwi.Plugins.InAppPurchase.InAppPurchase.prototype.init=function(a,b){return Cocoon.Store.nativeAvailable&&this.game.deviceTargetOption==Kiwi.TARGET_COCOON&&!Cocoon.Store.canPurchase()?(this.game.debugOption==Kiwi.DEBUG_ON&&console.log("Could not initialise Store."),!1):(0==this.available&&(this.available=!0),"undefined"==typeof b&&(b=!0),"undefined"==typeof a&&(a=!1),this.game.debugOption==Kiwi.DEBUG_ON&&(Kiwi.Log.log("Initialisation Starting","#inAppPurchase"),Kiwi.Log.log("Sandbox is "+b.toString(),"#inAppPurchase"),Kiwi.Log.log("Managed Mode is "+a.toString(),"#inAppPurchase")),this._startEvents(),this._managed=a,this._sandbox=b,Cocoon.Store.initialize({sandbox:b,managed:a}),this.retrieveProducts(),this.retrievePurchases(),!0)},Kiwi.Plugins.InAppPurchase.InAppPurchase.prototype.retrievePurchases=function(){if(this.available){this.game.debugOption==Kiwi.DEBUG_ON&&Kiwi.Log.log("Retrieveing Purchases","#inAppPurchase");var a=Cocoon.Store.getPurchases();"undefined"!=typeof a&&(Kiwi.Log.log("Type of Purchase: "+typeof a,"#inAppPurchase"),this._purchases=a)}},Kiwi.Plugins.InAppPurchase.InAppPurchase.prototype.retrieveProducts=function(){if(this.available){this.game.debugOption==Kiwi.DEBUG_ON&&Kiwi.Log.log("Retrieveing Products","#inAppPurchase");var a=Cocoon.Store.getProducts();"undefined"!=typeof a&&(this._products=a)}},Kiwi.Plugins.InAppPurchase.InAppPurchase.prototype.getProductById=function(a){if("undefined"!=typeof a)for(var b=0;b<this._products.length;b++)if(this._products[b].productId==a)return this._products[b];return null},Object.defineProperty(Kiwi.Plugins.InAppPurchase.InAppPurchase.prototype,"products",{get:function(){return this._products},enumerable:!0,configurable:!0}),Object.defineProperty(Kiwi.Plugins.InAppPurchase.InAppPurchase.prototype,"purchases",{get:function(){return this._purchases},enumerable:!0,configurable:!0}),Kiwi.Plugins.InAppPurchase.InAppPurchase.prototype.fetchProductsFromStore=function(a){Kiwi.Log.log("Use of this method has been deprecated. It will still work, but recommend use of 'loadProducts' instead.","#inAppPurchase"),this.loadProducts(a)},Kiwi.Plugins.InAppPurchase.InAppPurchase.prototype.loadProducts=function(a){this.available&&"undefined"!=typeof a&&(this.game.debugOption==Kiwi.DEBUG_ON&&Kiwi.Log.log("Now trying to fetch the products from the store.","#inAppPurchase"),Cocoon.Store.loadProducts(a))},Kiwi.Plugins.InAppPurchase.InAppPurchase.prototype.createProduct=function(a,b,c,d,e,f,g,h){if(this.available){this.game.debugOption==Kiwi.DEBUG_ON&&Kiwi.Log.log("Addition of a product started");var i={productId:b,productAlias:a,productType:c,title:d,description:e,price:f,localizedPrice:g,downloadURL:h};this.addProduct(i)}},Kiwi.Plugins.InAppPurchase.InAppPurchase.prototype.addProduct=function(a){this.available&&"undefined"!=typeof a&&(Kiwi.DEBUG_ON==this.game.debugOption&&Kiwi.Log.log("Product Addition started."),Cocoon.Store.addProduct(a),this.retrieveProducts())},Kiwi.Plugins.InAppPurchase.InAppPurchase.prototype.removeProduct=function(a){this.available&&(this.game.debugOption==Kiwi.DEBUG_ON&&Kiwi.Log.log("Removal of a product started"),Cocoon.Store.removeProduct(a))},Kiwi.Plugins.InAppPurchase.InAppPurchase.prototype.purchaseProduct=function(a){Kiwi.Log.log("This method has been deprecated. This method will still work, but you should use 'purchase' instead."),this.purchase(a)},Kiwi.Plugins.InAppPurchase.InAppPurchase.prototype.purchase=function(a){return"undefined"==typeof a||0==this.available||0==Cocoon.Store.canPurchase()?void(this.game.debugOption==Kiwi.DEBUG_ON&&Kiwi.Log.log("Purchase of a product could not be preformed.","#inAppPurchase")):(this.game.debugOption==Kiwi.DEBUG_ON&&Kiwi.Log.log("Purchase of a product started.","#inAppPurchase"),void Cocoon.Store.purchase(a))},Kiwi.Plugins.InAppPurchase.InAppPurchase.prototype.purchaseProductModal=function(a){"undefined"!=typeof a&&0!=this.available&&(this.game.debugOption==Kiwi.DEBUG_ON&&Kiwi.Log.log("Purchase of a product with a progress dialog starting.","#inAppPurchase"),Cocoon.Store.puchaseProductModal(a))},Kiwi.Plugins.InAppPurchase.InAppPurchase.prototype.purchaseProductModalWithPreview=function(a){"undefined"!=typeof a&&0!=this.available&&(this.game.debugOption==Kiwi.DEBUG_ON&&Kiwi.Log.log("Purchase of a product with a preview happening.","#inAppPurchase"),Cocoon.Store.purchaseProductModalWithPreview(a))},Kiwi.Plugins.InAppPurchase.InAppPurchase.prototype.isPurchased=function(a){return 0==this.available||"undefined"==typeof a?!1:Cocoon.Store.isProductPurchased(a)},Kiwi.Plugins.InAppPurchase.InAppPurchase.prototype.addPurchase=function(a){"undefined"!=typeof a&&0!=this.available&&(this.game.debugOption==Kiwi.DEBUG_ON&&Kiwi.Log.log("Purchase Addition Process Started","#inAppPurchase"),Cocoon.Store.addPurchase(a))},Kiwi.Plugins.InAppPurchase.InAppPurchase.prototype.removePurchase=function(a){return"undefined"!=typeof a&&0!=this.available?(this.game.debugOption==Kiwi.DEBUG_ON&&Kiwi.Log.log("Purchase Removal Process Starting","#inAppPurchase"),Cocoon.Store.removePurchase(a)):void 0},Kiwi.Plugins.InAppPurchase.InAppPurchase.prototype.consumePurchase=function(a){Kiwi.Log.log("This method is deprecated. It will still work but you should use 'consume' instead.","#inAppPurchase"),this.consume(a)},Kiwi.Plugins.InAppPurchase.InAppPurchase.prototype.consume=function(a){"undefined"!=typeof a&&0!=this.available&&(this.game.debugOption==Kiwi.DEBUG_ON&&Kiwi.Log.log("Purchase Consumation Process Starting","#inAppPurchase"),Cocoon.Store.consume(a.transactionId,a.productId))},Kiwi.Plugins.InAppPurchase.InAppPurchase.prototype.restorePurchases=function(){Kiwi.Log.log("This method has been deprecated. You should use the 'restore' method instead.","#inAppPurchase"),this.restore()},Kiwi.Plugins.InAppPurchase.InAppPurchase.prototype.restore=function(){1==this.available&&(this.game.debugOption==Kiwi.DEBUG_ON&&Kiwi.Log.log("Purchase Restoration Started.","#inAppPurchase"),Cocoon.Store.restore())},Kiwi.Plugins.InAppPurchase.InAppPurchase.prototype.restorePurchasesModal=function(){1==this.available&&(this.game.debugOption==Kiwi.DEBUG_ON&&Kiwi.Log.log("Purchase Restoration with Modal Started.","#inAppPurchase"),Cocoon.Store.restorePurchasesModal())},Kiwi.Plugins.InAppPurchase.InAppPurchase.prototype.finishPurchase=function(a){Kiwi.Log.log("This method is deprecated. This method will still work, but you should use the 'finish' method instead.","#inAppPurchase"),this.finish(a)},Kiwi.Plugins.InAppPurchase.InAppPurchase.prototype.finish=function(a){if(this.available){if("undefined"!=typeof this._purchases)for(var b=0;b<this._purchases.length;b++)if(this._purchases[b].transactionId==a)return!1;return this.game.debugOption==Kiwi.DEBUG_ON&&Kiwi.Log.log("TransactionID "+a+" has been finialized","#inAppPurchase"),Cocoon.Store.finish(a),!0}},Kiwi.Plugins.InAppPurchase.InAppPurchase.prototype.objType=function(){return"inAppPurchase"},Kiwi.Plugins.InAppPurchase.InAppPurchase.prototype._createCallbacks=function(){this.onFetchStarted=new Kiwi.Signal,this.onFetchFailed=new Kiwi.Signal,this.onFetchComplete=new Kiwi.Signal,this.onRestoreStarted=new Kiwi.Signal,this.onRestoreComplete=new Kiwi.Signal,this.onRestoreFailed=new Kiwi.Signal,this.onPurchaseStarted=new Kiwi.Signal,this.onPurchaseFailed=new Kiwi.Signal,this.onPurchaseVertification=new Kiwi.Signal,this.onPurchaseComplete=new Kiwi.Signal,this.onConsumeStarted=new Kiwi.Signal,this.onConsumeComplete=new Kiwi.Signal,this.onConsumeFailed=new Kiwi.Signal},Kiwi.Plugins.InAppPurchase.InAppPurchase.prototype._startEvents=function(){Cocoon.Store.onProductsFetchStarted.addEventListener(this._onProductsFetchStarted.bind(this)),Cocoon.Store.onProductsFetchFailed.addEventListener(this._onProductsFetchFailed.bind(this)),Cocoon.Store.onProductsFetchCompleted.addEventListener(this._onProductsFetchCompleted.bind(this)),Cocoon.Store.onRestorePurchasesStarted.addEventListener(this._onRestorePurchasesStarted.bind(this)),Cocoon.Store.onRestorePurchasesCompleted.addEventListener(this._onRestorePurchasesCompleted.bind(this)),Cocoon.Store.onRestorePurchasesFailed.addEventListener(this._onRestorePurchasesFailed.bind(this)),Cocoon.Store.onProductPurchaseStarted.addEventListener(this._onProductPurchaseStarted.bind(this)),Cocoon.Store.onProductPurchaseFailed.addEventListener(this._onProductPurchaseFailed.bind(this)),Cocoon.Store.onProductPurchaseVerificationRequestReceived.addEventListener(this._onProductPurchaseVerificationRequestReceived.bind(this)),Cocoon.Store.onProductPurchaseCompleted.addEventListener(this._onProductPurchaseCompleted.bind(this)),Cocoon.Store.onConsumePurchaseStarted.addEventListener(this._onConsumePurchaseStarted.bind(this)),Cocoon.Store.onConsumePurchaseCompleted.addEventListener(this._onConsumePurchaseCompleted.bind(this)),Cocoon.Store.onConsumePurchaseFailed.addEventListener(this._onConsumePurchaseFailed.bind(this))},Kiwi.Plugins.InAppPurchase.InAppPurchase.prototype._onProductsFetchStarted=function(){this.game.debugOption==Kiwi.DEBUG_ON&&console.log("Products Fetch has Started."),this.onFetchStarted.dispatch()},Kiwi.Plugins.InAppPurchase.InAppPurchase.prototype._onProductsFetchFailed=function(a){this.game.debugOption==Kiwi.DEBUG_ON&&Kiwi.Log.log("Products Fetch has Failed: "+a,"#inAppPurchase"),this.onFetchFailed.dispatch(a)},Kiwi.Plugins.InAppPurchase.InAppPurchase.prototype._onProductsFetchCompleted=function(a){if(this.game.debugOption==Kiwi.DEBUG_ON){Kiwi.Log.log("Products Fetch has Succeed.","#inAppPurchase");for(var b in a)Kiwi.Log.log("Product "+a[b].productId+" Vertified","#inAppPurchase")}if(1==this.addProducts)for(var b in a)this.addProduct(a[b]);this.onFetchComplete.dispatch(a)},Kiwi.Plugins.InAppPurchase.InAppPurchase.prototype._onRestorePurchasesStarted=function(){this.game.debugOption==Kiwi.DEBUG_ON&&Kiwi.Log.log("Purchase Restoration Started.","#inAppPurchase"),this.onRestoreStarted.dispatch()},Kiwi.Plugins.InAppPurchase.InAppPurchase.prototype._onRestorePurchasesCompleted=function(){this.game.debugOption==Kiwi.DEBUG_ON&&Kiwi.Log.log("Purchase Restoration Completed.","#inAppPurchase"),this.onRestoreCompleted.dispatch()},Kiwi.Plugins.InAppPurchase.InAppPurchase.prototype._onRestorePurchasesFailed=function(a){this.game.debugOption==Kiwi.DEBUG_ON&&Kiwi.Log.log("Purchase Restoration Failed: "+a,"#inAppPurchase"),this.onRestoreFailed.dispatch(a)},Kiwi.Plugins.InAppPurchase.InAppPurchase.prototype._onProductPurchaseStarted=function(a){this.game.debugOption==Kiwi.DEBUG_ON&&Kiwi.Log.log("Product Purchase Started: "+a,"#inAppPurchase"),this.onPurchaseStarted.dispatch(a)},Kiwi.Plugins.InAppPurchase.InAppPurchase.prototype._onProductPurchaseFailed=function(a,b){this.game.debugOption==Kiwi.DEBUG_ON&&Kiwi.Log.log("Product Purchase of "+a+" failed: "+b,"#inAppPurchase"),this.onPurchaseFailed.dispatch(a,b)},Kiwi.Plugins.InAppPurchase.InAppPurchase.prototype._onProductPurchaseVerificationRequestReceived=function(a,b){this.game.debugOption==Kiwi.DEBUG_ON&&Kiwi.Log.log("Product "+a+" Verification Requested","#inAppPurchase"),this.onPurchaseVertification.dispatch(a,b)},Kiwi.Plugins.InAppPurchase.InAppPurchase.prototype._onProductPurchaseCompleted=function(a){this.game.debugOption==Kiwi.DEBUG_ON&&Kiwi.Log.log("Purchase Completed: "+a.productId,"#inAppPurchase"),1==this.autoConsume&&this.getProductById(a.productId).productType==Kiwi.Plugins.InAppPurchase.InAppPurchase.CONSUMABLE&&(this.game.debugOption==Kiwi.DEBUG_ON&&Kiwi.Log.log("Purchase being Auto Consumed.","#inAppPurchase"),this.consumePurchase(a)),this.finishPurchase(a.transactionId),this.addPurchases&&this.addPurchase(a),this.retrievePurchases(),this.onPurchaseComplete.dispatch(a)},Kiwi.Plugins.InAppPurchase.InAppPurchase.prototype._onConsumePurchaseStarted=function(a){this.game.debugOption==Kiwi.DEBUG_ON&&Kiwi.Log.log("Consume of transaction Started.","#inAppPurchase"),this.onConsumeStarted.dispatch(a)},Kiwi.Plugins.InAppPurchase.InAppPurchase.prototype._onConsumePurchaseCompleted=function(a){this.game.debugOption==Kiwi.DEBUG_ON&&Kiwi.Log.log("Consume of transaction success","#inAppPurchase"),this.onConsumeComplete.dispatch(a)},Kiwi.Plugins.InAppPurchase.InAppPurchase.prototype._onConsumePurchaseFailed=function(a,b){this.game.debugOption==Kiwi.DEBUG_ON&&Kiwi.Log.log("Consume of transaction "+a+" has failed: "+b,"#inAppPurchase"),this.onConsumeFailed.dispatch(a,b)},Object.defineProperty(Kiwi.Plugins.InAppPurchase.InAppPurchase,"CONSUMABLE",{get:function(){return Cocoon.Store.ProductType.CONSUMABLE},enumerable:!0,configurable:!0}),Object.defineProperty(Kiwi.Plugins.InAppPurchase.InAppPurchase,"NON_CONSUMABLE",{get:function(){return Cocoon.Store.ProductType.NON_CONSUMABLE},enumerable:!0,configurable:!0}),Object.defineProperty(Kiwi.Plugins.InAppPurchase.InAppPurchase,"AUTO_RENEWABLE_SUBSCRIPTION",{get:function(){return Cocoon.Store.ProductType.AUTO_RENEWABLE_SUBSCRIPTION},enumerable:!0,configurable:!0}),Object.defineProperty(Kiwi.Plugins.InAppPurchase.InAppPurchase,"FREE_SUBSCRIPTION",{get:function(){return Cocoon.Store.ProductType.FREE_SUBSCRIPTION},enumerable:!0,configurable:!0}),Object.defineProperty(Kiwi.Plugins.InAppPurchase.InAppPurchase,"NON_RENEWABLE_SUBSCRIPTION",{get:function(){return Cocoon.Store.ProductType.NON_RENEWABLE_SUBSCRIPTION},enumerable:!0,configurable:!0}),Object.defineProperty(Kiwi.Plugins.InAppPurchase.InAppPurchase,"APP_STORE",{get:function(){return Cocoon.Store.StoreType.APP_STORE},enumerable:!0,configurable:!0}),Object.defineProperty(Kiwi.Plugins.InAppPurchase.InAppPurchase,"PLAY_STORE",{get:function(){return Cocoon.Store.StoreType.PLAY_STORE},enumerable:!0,configurable:!0}),Object.defineProperty(Kiwi.Plugins.InAppPurchase.InAppPurchase,"MOCK_STORE",{get:function(){return Cocoon.Store.StoreType.MOCK_STORE},enumerable:!0,configurable:!0}),Object.defineProperty(Kiwi.Plugins.InAppPurchase.InAppPurchase,"CHROME_STORE",{get:function(){return Cocoon.Store.StoreType.CHROME_STORE},enumerable:!0,configurable:!0}),Object.defineProperty(Kiwi.Plugins.InAppPurchase.InAppPurchase,"AMAZON_STORE",{get:function(){return Cocoon.Store.StoreType.AMAZON_STORE},enumerable:!0,configurable:!0}),Object.defineProperty(Kiwi.Plugins.InAppPurchase.InAppPurchase,"NOOK_STORE",{get:function(){return Cocoon.Store.StoreType.NOOK_STORE},enumerable:!0,configurable:!0}),Object.defineProperty(Kiwi.Plugins.InAppPurchase.InAppPurchase,"PURCHASED",{get:function(){return Cocoon.Store.PurchaseState.PURCHASED},enumerable:!0,configurable:!0}),Object.defineProperty(Kiwi.Plugins.InAppPurchase.InAppPurchase,"CANCELLED",{get:function(){return Cocoon.Store.PurchaseState.CANCELED},enumerable:!0,configurable:!0}),Object.defineProperty(Kiwi.Plugins.InAppPurchase.InAppPurchase,"REFUNDED",{get:function(){return Cocoon.Store.PurchaseState.REFUNDED},enumerable:!0,configurable:!0}),Object.defineProperty(Kiwi.Plugins.InAppPurchase.InAppPurchase,"EXPIRED",{get:function(){return Cocoon.Store.PurchaseState.EXPIRED},enumerable:!0,configurable:!0}),Kiwi.Plugins.InAppPurchase.InAppPurchase.prototype.expirePurchase=function(a){this.available&&this.getStoreType()==this.MOCK_STORE&&"undefined"!=typeof a&&Cocoon.Store.expirePurchase(a)},Kiwi.Plugins.InAppPurchase.InAppPurchase.prototype.cancelPurchase=function(a){this.available&&this.getStoreType()==this.MOCK_STORE&&"undefined"!=typeof a&&Cocoon.Store.cancelPurchase(a)},Kiwi.Plugins.InAppPurchase.InAppPurchase.prototype.refundPurchase=function(a){this.available&&this.getStoreType()==this.MOCK_STORE&&"undefined"!=typeof a&&Cocoon.Store.refundPurchase(a)};