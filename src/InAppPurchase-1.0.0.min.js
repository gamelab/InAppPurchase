Kiwi.Plugins.InAppPurchase={name:"InAppPurchase",version:"1.0.0",minimumKiwiVersion:"1.0.0"},Kiwi.PluginManager.register(Kiwi.Plugins.InAppPurchase),Kiwi.Plugins.InAppPurchase.create=function(a){return a.inAppPurchase=new Kiwi.Plugins.InAppPurchase.InAppPurchase(a),a.inAppPurchase},Kiwi.Plugins.InAppPurchase.InAppPurchase=function(a){this.game=a,this.available=!1},Kiwi.Plugins.InAppPurchase.InAppPurchase.prototype.boot=function(){this.bundleId=null,this.apiVersion=null,this.storeType=CocoonJS.Store.getStoreType(),this._products=[],this._purchases=[],this.addPurchases=!0,this.addProducts=!1,this.autoConsume=!1,this._managed=null,this._sandbox=null,this._createCallbacks(),CocoonJS.Store.nativeExtensionObjectAvailable&&this.game.deviceTargetOption==Kiwi.TARGET_COCOON&&0==CocoonJS.Store.canPurchase()?this.game.debugOption==Kiwi.DEBUG_ON&&console.log("Cannot Use the InAppPurchase Plugin."):this.available=!0},Kiwi.Plugins.InAppPurchase.InAppPurchase.prototype.getStoreType=function(){return CocoonJS.Store.getStoreType()},Kiwi.Plugins.InAppPurchase.InAppPurchase.prototype.init=function(a,b){return CocoonJS.Store.nativeExtensionObjectAvailable&&this.game.deviceTargetOption==Kiwi.TARGET_COCOON&&0==CocoonJS.Store.canPurchase()?(this.game.debugOption==Kiwi.DEBUG_ON&&console.log("Could not initialise Store."),!1):(0==this.available&&(this.available=!0),"undefined"==typeof b&&(b=!0),"undefined"==typeof a&&(a=!1),this.game.debugOption==Kiwi.DEBUG_ON&&(console.log("Initialisation Starting"),console.log("Sandbox is "+b.toString()),console.log("Managed Mode is "+a.toString())),this._startEvents(),this._managed=a,this._sandbox=b,CocoonJS.Store.requestInitialization({sandbox:b,managed:a}),CocoonJS.Store.start(),this.retrieveProducts(),this.retrievePurchases(),!0)},Kiwi.Plugins.InAppPurchase.InAppPurchase.prototype.retrievePurchases=function(){if(this.available){this.game.debugOption==Kiwi.DEBUG_ON&&console.log("Retrieveing Purchases");var a=CocoonJS.Store.getPurchases();"undefined"!=typeof a&&(console.log("Type of Purchase: "+typeof a),this._purchases=a)}},Kiwi.Plugins.InAppPurchase.InAppPurchase.prototype.retrieveProducts=function(){if(this.available){this.game.debugOption==Kiwi.DEBUG_ON&&console.log("Retrieveing Products");var a=CocoonJS.Store.getProducts();"undefined"!=typeof a&&(this._products=a)}},Kiwi.Plugins.InAppPurchase.InAppPurchase.prototype.getProductById=function(a){if("undefined"!=typeof a)for(var b=0;b<this._products.length;b++)if(this._products[b].productId==a)return this._products[b];return null},Object.defineProperty(Kiwi.Plugins.InAppPurchase.InAppPurchase.prototype,"products",{get:function(){return this._products},enumerable:!0,configurable:!0}),Object.defineProperty(Kiwi.Plugins.InAppPurchase.InAppPurchase.prototype,"purchases",{get:function(){return this._purchases},enumerable:!0,configurable:!0}),Kiwi.Plugins.InAppPurchase.InAppPurchase.prototype.fetchProductsFromStore=function(a){this.available&&"undefined"!=typeof a&&(this.game.debugOption==Kiwi.DEBUG_ON&&console.log("Now trying to fetch the products from the store."),CocoonJS.Store.fetchProductsFromStore(a))},Kiwi.Plugins.InAppPurchase.InAppPurchase.prototype.createProduct=function(a,b,c,d,e,f,g,h){if(this.available){this.game.debugOption==Kiwi.DEBUG_ON&&console.log("Addition of a product started");var i=new CocoonJS.Store.ProductInfo(a,b,c,d,e,f,g,h);this.addProduct(i)}},Kiwi.Plugins.InAppPurchase.InAppPurchase.prototype.addProduct=function(a){this.available&&"undefined"!=typeof a&&(Kiwi.DEBUG_ON==this.game.debugOption&&console.log("Product Addition started."),CocoonJS.Store.addProduct(a),this.retrieveProducts())},Kiwi.Plugins.InAppPurchase.InAppPurchase.prototype.removeProduct=function(a){this.available&&(this.game.debugOption==Kiwi.DEBUG_ON&&console.log("Removal of a product started"),CocoonJS.Store.removeProduct(a))},Kiwi.Plugins.InAppPurchase.InAppPurchase.prototype.purchaseProduct=function(a){return"undefined"==typeof a||0==this.available||0==CocoonJS.Store.canPurchase()?void(this.game.debugOption==Kiwi.DEBUG_ON&&console.log("Purchase of a product could not be preformed.")):(this.game.debugOption==Kiwi.DEBUG_ON&&console.log("Purchase of a product started."),void CocoonJS.Store.purchaseProduct(a))},Kiwi.Plugins.InAppPurchase.InAppPurchase.prototype.purchaseProductModal=function(a){"undefined"!=typeof a&&0!=this.available&&(this.game.debugOption==Kiwi.DEBUG_ON&&console.log("Purchase of a product with a progress dialog starting."),CocoonJS.Store.puchaseProductModal(a))},Kiwi.Plugins.InAppPurchase.InAppPurchase.prototype.purchaseProductModalWithPreview=function(a){"undefined"!=typeof a&&0!=this.available&&(this.game.debugOption==Kiwi.DEBUG_ON&&console.log("Purchase of a product with a preview happening."),CocoonJS.Store.purchaseProductModalWithPreview(a))},Kiwi.Plugins.InAppPurchase.InAppPurchase.prototype.isPurchased=function(a){return 0==this.available||"undefined"==typeof a?!1:CocoonJS.Store.isProductPurchased(a)},Kiwi.Plugins.InAppPurchase.InAppPurchase.prototype.addPurchase=function(a){"undefined"!=typeof a&&0!=this.available&&(this.game.debugOption==Kiwi.DEBUG_ON&&console.log("Purchase Addition Process Started"),CocoonJS.Store.addPurchase(a))},Kiwi.Plugins.InAppPurchase.InAppPurchase.prototype.removePurchase=function(a){return"undefined"!=typeof a&&0!=this.available?(this.game.debugOption==Kiwi.DEBUG_ON&&console.log("Purchase Removal Process Starting"),CocoonJS.Store.removePurchase(a)):void 0},Kiwi.Plugins.InAppPurchase.InAppPurchase.prototype.consumePurchase=function(a){"undefined"!=typeof a&&0!=this.available&&(this.game.debugOption==Kiwi.DEBUG_ON&&console.log("Purchase Consumation Process Starting"),CocoonJS.Store.consumePurchase(a.transactionId,a.productId))},Kiwi.Plugins.InAppPurchase.InAppPurchase.prototype.restorePurchases=function(){1==this.available&&(this.game.debugOption==Kiwi.DEBUG_ON&&console.log("Purchase Restoration Started."),CocoonJS.Store.restorePurchases())},Kiwi.Plugins.InAppPurchase.InAppPurchase.prototype.restorePurchasesModal=function(){1==this.available&&(this.game.debugOption==Kiwi.DEBUG_ON&&console.log("Purchase Restoration with Modal Started."),CocoonJS.Store.restorePurchasesModal())},Kiwi.Plugins.InAppPurchase.InAppPurchase.prototype.finishPurchase=function(a){if(this.available){if("undefined"!=typeof this._purchases)for(var b=0;b<this._purchases.length;b++)if(this._purchases[b].transactionId==a)return!1;return this.game.debugOption==Kiwi.DEBUG_ON&&console.log("TransactionID "+a+" has been finialized"),CocoonJS.Store.finishPurchase(a),!0}},Kiwi.Plugins.InAppPurchase.InAppPurchase.prototype.objType=function(){return"inAppPurchase"},Kiwi.Plugins.InAppPurchase.InAppPurchase.prototype._createCallbacks=function(){this.onFetchStarted=new Kiwi.Signal,this.onFetchFailed=new Kiwi.Signal,this.onFetchComplete=new Kiwi.Signal,this.onRestoreStarted=new Kiwi.Signal,this.onRestoreComplete=new Kiwi.Signal,this.onRestoreFailed=new Kiwi.Signal,this.onPurchaseStarted=new Kiwi.Signal,this.onPurchaseFailed=new Kiwi.Signal,this.onPurchaseVertification=new Kiwi.Signal,this.onPurchaseComplete=new Kiwi.Signal,this.onConsumeStarted=new Kiwi.Signal,this.onConsumeComplete=new Kiwi.Signal,this.onConsumeFailed=new Kiwi.Signal},Kiwi.Plugins.InAppPurchase.InAppPurchase.prototype._startEvents=function(){CocoonJS.Store.onProductsFetchStarted.addEventListener(this._onProductsFetchStarted.bind(this)),CocoonJS.Store.onProductsFetchFailed.addEventListener(this._onProductsFetchFailed.bind(this)),CocoonJS.Store.onProductsFetchCompleted.addEventListener(this._onProductsFetchCompleted.bind(this)),CocoonJS.Store.onRestorePurchasesStarted.addEventListener(this._onRestorePurchasesStarted.bind(this)),CocoonJS.Store.onRestorePurchasesCompleted.addEventListener(this._onRestorePurchasesCompleted.bind(this)),CocoonJS.Store.onRestorePurchasesFailed.addEventListener(this._onRestorePurchasesFailed.bind(this)),CocoonJS.Store.onProductPurchaseStarted.addEventListener(this._onProductPurchaseStarted.bind(this)),CocoonJS.Store.onProductPurchaseFailed.addEventListener(this._onProductPurchaseFailed.bind(this)),CocoonJS.Store.onProductPurchaseVerificationRequestReceived.addEventListener(this._onProductPurchaseVerificationRequestReceived.bind(this)),CocoonJS.Store.onProductPurchaseCompleted.addEventListener(this._onProductPurchaseCompleted.bind(this)),CocoonJS.Store.onConsumePurchaseStarted.addEventListener(this._onConsumePurchaseStarted.bind(this)),CocoonJS.Store.onConsumePurchaseCompleted.addEventListener(this._onConsumePurchaseCompleted.bind(this)),CocoonJS.Store.onConsumePurchaseFailed.addEventListener(this._onConsumePurchaseFailed.bind(this))},Kiwi.Plugins.InAppPurchase.InAppPurchase.prototype._onProductsFetchStarted=function(){this.game.debugOption==Kiwi.DEBUG_ON&&console.log("Products Fetch has Started."),this.onFetchStarted.dispatch()},Kiwi.Plugins.InAppPurchase.InAppPurchase.prototype._onProductsFetchFailed=function(a){this.game.debugOption==Kiwi.DEBUG_ON&&console.log("Products Fetch has Failed: "+a),this.onFetchFailed.dispatch(a)},Kiwi.Plugins.InAppPurchase.InAppPurchase.prototype._onProductsFetchCompleted=function(a){if(this.game.debugOption==Kiwi.DEBUG_ON){console.log("Products Fetch has Succeed.");for(var b in a)console.log("Product "+a[b].productId+" Vertified")}if(1==this.addProducts)for(var b in a)this.addProduct(a[b]);this.onFetchComplete.dispatch(a)},Kiwi.Plugins.InAppPurchase.InAppPurchase.prototype._onRestorePurchasesStarted=function(){this.game.debugOption==Kiwi.DEBUG_ON&&console.log("Purchase Restoration Started."),this.onRestoreStarted.dispatch()},Kiwi.Plugins.InAppPurchase.InAppPurchase.prototype._onRestorePurchasesCompleted=function(){this.game.debugOption==Kiwi.DEBUG_ON&&console.log("Purchase Restoration Completed."),this.onRestoreCompleted.dispatch()},Kiwi.Plugins.InAppPurchase.InAppPurchase.prototype._onRestorePurchasesFailed=function(a){this.game.debugOption==Kiwi.DEBUG_ON&&console.log("Purchase Restoration Failed: "+a),this.onRestoreFailed.dispatch(a)},Kiwi.Plugins.InAppPurchase.InAppPurchase.prototype._onProductPurchaseStarted=function(a){this.game.debugOption==Kiwi.DEBUG_ON&&console.log("Product Purchase Started: "+a),this.onPurchaseStarted.dispatch(a)},Kiwi.Plugins.InAppPurchase.InAppPurchase.prototype._onProductPurchaseFailed=function(a,b){this.game.debugOption==Kiwi.DEBUG_ON&&console.log("Product Purchase of "+a+" failed: "+b),this.onPurchaseFailed.dispatch(a,b)},Kiwi.Plugins.InAppPurchase.InAppPurchase.prototype._onProductPurchaseVerificationRequestReceived=function(a,b){this.game.debugOption==Kiwi.DEBUG_ON&&console.log("Product "+a+" Verification Requested"),console.log(b),this.onPurchaseVertification.dispatch(a,b)},Kiwi.Plugins.InAppPurchase.InAppPurchase.prototype._onProductPurchaseCompleted=function(a){this.game.debugOption==Kiwi.DEBUG_ON&&console.log("Purchase Completed: "+a.productId),1==this.autoConsume&&this.getProductById(a.productId).productType==Kiwi.Plugins.InAppPurchase.InAppPurchase.CONSUMABLE&&(this.game.debugOption==Kiwi.DEBUG_ON&&console.log("Purchase being Auto Consumed."),this.consumePurchase(a)),this.finishPurchase(a.transactionId),this.addPurchases&&this.addPurchase(a),this.retrievePurchases(),this.onPurchaseComplete.dispatch(a)},Kiwi.Plugins.InAppPurchase.InAppPurchase.prototype._onConsumePurchaseStarted=function(a){this.game.debugOption==Kiwi.DEBUG_ON&&console.log("Consume of transaction Started."),this.onConsumeStarted.dispatch(a)},Kiwi.Plugins.InAppPurchase.InAppPurchase.prototype._onConsumePurchaseCompleted=function(a){this.game.debugOption==Kiwi.DEBUG_ON&&console.log("Consume of transaction success"),this.onConsumeComplete.dispatch(a)},Kiwi.Plugins.InAppPurchase.InAppPurchase.prototype._onConsumePurchaseFailed=function(a,b){this.game.debugOption==Kiwi.DEBUG_ON&&console.log("Consume of transaction "+a+" has failed: "+b),this.onConsumeFailed.dispatch(a,b)},Object.defineProperty(Kiwi.Plugins.InAppPurchase.InAppPurchase,"CONSUMABLE",{get:function(){return CocoonJS.Store.ProductType.CONSUMABLE},enumerable:!0,configurable:!0}),Object.defineProperty(Kiwi.Plugins.InAppPurchase.InAppPurchase,"NON_CONSUMABLE",{get:function(){return CocoonJS.Store.ProductType.NON_CONSUMABLE},enumerable:!0,configurable:!0}),Object.defineProperty(Kiwi.Plugins.InAppPurchase.InAppPurchase,"AUTO_RENEWABLE_SUBSCRIPTION",{get:function(){return CocoonJS.Store.ProductType.AUTO_RENEWABLE_SUBSCRIPTION},enumerable:!0,configurable:!0}),Object.defineProperty(Kiwi.Plugins.InAppPurchase.InAppPurchase,"FREE_SUBSCRIPTION",{get:function(){return CocoonJS.Store.ProductType.FREE_SUBSCRIPTION},enumerable:!0,configurable:!0}),Object.defineProperty(Kiwi.Plugins.InAppPurchase.InAppPurchase,"NON_RENEWABLE_SUBSCRIPTION",{get:function(){return CocoonJS.Store.ProductType.NON_RENEWABLE_SUBSCRIPTION},enumerable:!0,configurable:!0}),Object.defineProperty(Kiwi.Plugins.InAppPurchase.InAppPurchase,"APP_STORE",{get:function(){return CocoonJS.Store.StoreType.APP_STORE},enumerable:!0,configurable:!0}),Object.defineProperty(Kiwi.Plugins.InAppPurchase.InAppPurchase,"PLAY_STORE",{get:function(){return CocoonJS.Store.StoreType.PLAY_STORE},enumerable:!0,configurable:!0}),Object.defineProperty(Kiwi.Plugins.InAppPurchase.InAppPurchase,"MOCK_STORE",{get:function(){return CocoonJS.Store.StoreType.MOCK_STORE},enumerable:!0,configurable:!0}),Object.defineProperty(Kiwi.Plugins.InAppPurchase.InAppPurchase,"CHROME_STORE",{get:function(){return CocoonJS.Store.StoreType.CHROME_STORE},enumerable:!0,configurable:!0}),Object.defineProperty(Kiwi.Plugins.InAppPurchase.InAppPurchase,"AMAZON_STORE",{get:function(){return CocoonJS.Store.StoreType.AMAZON_STORE},enumerable:!0,configurable:!0}),Object.defineProperty(Kiwi.Plugins.InAppPurchase.InAppPurchase,"NOOK_STORE",{get:function(){return CocoonJS.Store.StoreType.NOOK_STORE},enumerable:!0,configurable:!0}),Object.defineProperty(Kiwi.Plugins.InAppPurchase.InAppPurchase,"PURCHASED",{get:function(){return CocoonJS.Store.PurchaseState.PURCHASED},enumerable:!0,configurable:!0}),Object.defineProperty(Kiwi.Plugins.InAppPurchase.InAppPurchase,"CANCELLED",{get:function(){return CocoonJS.Store.PurchaseState.CANCELED},enumerable:!0,configurable:!0}),Object.defineProperty(Kiwi.Plugins.InAppPurchase.InAppPurchase,"REFUNDED",{get:function(){return CocoonJS.Store.PurchaseState.REFUNDED},enumerable:!0,configurable:!0}),Object.defineProperty(Kiwi.Plugins.InAppPurchase.InAppPurchase,"EXPIRED",{get:function(){return CocoonJS.Store.PurchaseState.EXPIRED},enumerable:!0,configurable:!0}),Kiwi.Plugins.InAppPurchase.InAppPurchase.prototype.expirePurchase=function(a){this.available&&this.getStoreType()==this.MOCK_STORE&&"undefined"!=typeof a&&CocoonJS.Store.expirePurchase(a)},Kiwi.Plugins.InAppPurchase.InAppPurchase.prototype.cancelPurchase=function(a){this.available&&this.getStoreType()==this.MOCK_STORE&&"undefined"!=typeof a&&CocoonJS.Store.cancelPurchase(a)},Kiwi.Plugins.InAppPurchase.InAppPurchase.prototype.refundPurchase=function(a){this.available&&this.getStoreType()==this.MOCK_STORE&&"undefined"!=typeof a&&CocoonJS.Store.refundPurchase(a)};